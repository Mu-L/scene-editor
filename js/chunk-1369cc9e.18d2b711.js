(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1369cc9e"],{"1b53":function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var o=r("5a89");function c(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(c.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),c.FullScreenQuad=function(){var e=new o["P"](-1,1,1,-1,0,1),t=new o["Q"](2,2),r=function(e){this._mesh=new o["E"](t,e)};return Object.defineProperty(r.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(r.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,e)}}),r}()},"3da4":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"DepthOfFiled-container"},[r("el-dialog",{attrs:{title:"相机景深",width:"500px",center:"",modal:!1,visible:e.$store.state.topNav.depthOfFiledVisible},on:{"update:visible":function(t){return e.$set(e.$store.state.topNav,"depthOfFiledVisible",t)}}},[r("div",{staticClass:"DepthOfFiled-main"},[r("MMD-switch",{attrs:{title:"启用"},model:{value:e.use,callback:function(t){e.use=t},expression:"use"}}),r("MMD-slider",{attrs:{title:"相机焦点",min:0,max:3e3,step:1},model:{value:e.pass.uniforms.focus.value,callback:function(t){e.$set(e.pass.uniforms.focus,"value",t)},expression:"pass.uniforms.focus.value"}}),r("MMD-slider",{attrs:{title:"相机光圈",min:0,max:20,step:.01},model:{value:e.aperture,callback:function(t){e.aperture=t},expression:"aperture"}}),r("MMD-slider",{attrs:{title:"模糊程度",min:0,max:20,step:.1},model:{value:e.maxblur,callback:function(t){e.maxblur=t},expression:"maxblur"}})],1)])],1)},c=[],l=r("5a89"),a=r("1b53"),s={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","\tvec2 aspectcorrect = vec2( 1.0, aspect );","\tfloat viewZ = getViewZ( getDepth( vUv ) );","\tfloat factor = ( focus + viewZ );","\tvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","\tvec2 dofblur9 = dofblur * 0.9;","\tvec2 dofblur7 = dofblur * 0.7;","\tvec2 dofblur4 = dofblur * 0.4;","\tvec4 col = vec4( 0.0 );","\tcol += texture2D( tColor, vUv.xy );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","\tgl_FragColor = col / 41.0;","\tgl_FragColor.a = 1.0;","}"].join("\n")},u=function(e,t,r){a["a"].call(this),this.scene=e,this.camera=t;var o=void 0!==r.focus?r.focus:1,c=void 0!==r.aspect?r.aspect:t.aspect,u=void 0!==r.aperture?r.aperture:.025,i=void 0!==r.maxblur?r.maxblur:1,n=r.width||window.innerWidth||1,v=r.height||window.innerHeight||1;this.renderTargetDepth=new l["pb"](n,v,{minFilter:l["J"],magFilter:l["J"],stencilBuffer:!1}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new l["G"],this.materialDepth.depthPacking=l["T"],this.materialDepth.blending=l["K"],void 0===s&&console.error("BokehPass relies on BokehShader");var p=s,f=l["lb"].clone(p.uniforms);f["tDepth"].value=this.renderTargetDepth.texture,f["focus"].value=o,f["aspect"].value=c,f["aperture"].value=u,f["maxblur"].value=i,f["nearClip"].value=t.near,f["farClip"].value=t.far,this.materialBokeh=new l["Y"]({defines:Object.assign({},p.defines),uniforms:f,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}),this.uniforms=f,this.needsSwap=!1,this.fsQuad=new a["a"].FullScreenQuad(this.materialBokeh),this.oldClearColor=new l["k"]};u.prototype=Object.assign(Object.create(a["a"].prototype),{constructor:u,render:function(e,t,r){this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(e.getClearColor());var o=e.getClearAlpha(),c=e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms["tColor"].value=r.texture,this.uniforms["nearClip"].value=this.camera.near,this.uniforms["farClip"].value=this.camera.far,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(o),e.autoClear=c}});var i={data:function(){return{pass:new u(MMD.MMDScene.scene,MMD.MMDScene.camera,{focus:1,aperture:25e-7,maxblur:.001}),controller:{use:!1}}},computed:{use:{get:function(){return this.controller.use},set:function(e){this.controller.use=e,console.log(this.pass),e?MMD.addPass(this.pass):MMD.removePass(this.pass)}},aperture:{get:function(){return this.pass.uniforms.aperture.value/1e-6},set:function(e){this.pass.uniforms.aperture.value=1e-6*e}},maxblur:{get:function(){return this.pass.uniforms.maxblur.value/.001},set:function(e){this.pass.uniforms.maxblur.value=.001*e}}}},n=i,v=r("2877"),p=Object(v["a"])(n,o,c,!1,null,"2ef716f8",null);t["default"]=p.exports}}]);