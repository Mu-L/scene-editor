var E=Object.defineProperty;var b=(t,o,e)=>o in t?E(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var v=(t,o,e)=>(b(t,typeof o!="symbol"?o+"":o,e),e);import{n as S,af as d,ai as g,ah as C,aA as N,u as _,i as u,a9 as O,M as l}from"./index-2dfd5781.js";import{e as f,f as w}from"./index-8ffcac79.js";import"./three-c85558b8.js";class x{constructor(o){v(this,"config");this.config=o}pipe(o){return this.config=o(this.config),this}get(){return this.config}}var $=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"containerOperation-container"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"loading-mask"},[e("vis-icon",{staticClass:"ani",attrs:{code:"#iconxuanzhuan"}}),e("span",[t._v("正在加载...")])],1),!t.loading&&!t.floderChildren.length?e("div",{staticClass:"empty-tips"},[e("span",[t._v("这里暂时是空的哦")])]):t._l(t.floderChildren,function(a,r){return e("div",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:`${a.name}`,expression:"`${item.name}`",modifiers:{bottom:!0}}],key:r,staticClass:"file-item-box"},[a.dir?[e("vis-icon",{attrs:{size:t.iconSize,code:"#iconwenjianjia"}})]:[e("img",{attrs:{src:a.preview}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.selected.id===a.id,expression:"selected.id === item.id"}],staticClass:"item-selected-mask",on:{click:function(n){return n.stopPropagation(),t.$store.commit("templateLibrary/cancelSelected")}}},[e("vis-icon",{staticClass:"item-selected",attrs:{size:"60px",code:"#icongou"}})],1)],e("span",{staticClass:"item-title",domProps:{textContent:t._s(a.name)}}),a.dir?e("span",{staticClass:"item-operate-box"},[e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"移动",expression:"`移动`",modifiers:{bottom:!0}}],attrs:{size:"20px",code:"#iconpingyi"}}),e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"打开",expression:"`打开`",modifiers:{bottom:!0}}],attrs:{size:"20px",code:"#iconyidong"},nativeOn:{click:function(n){return n.stopPropagation(),t.chouseFile(a)}}}),e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"删除",expression:"`删除`",modifiers:{bottom:!0}}],staticClass:"item-delete",attrs:{size:"16px",code:"#iconshanchu"},nativeOn:{click:function(n){return n.stopPropagation(),t.remove(a)}}})],1):e("span",{staticClass:"item-operate-box"},[e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"更新",expression:"`更新`",modifiers:{bottom:!0}}],attrs:{size:"16px",code:"#iconxuanzhuan"},nativeOn:{click:function(n){return n.stopPropagation(),t.updateTempalte(a)}}}),e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"应用",expression:"`应用`",modifiers:{bottom:!0}}],attrs:{size:"20px",code:"#iconyingyong"},nativeOn:{click:function(n){return n.stopPropagation(),t.useTemplate(a)}}}),e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"删除",expression:"`删除`",modifiers:{bottom:!0}}],staticClass:"item-delete",attrs:{size:"16px",code:"#iconshanchu"},nativeOn:{click:function(n){return n.stopPropagation(),t.remove(a)}}})],1)],2)}),e("div",{staticClass:"file-item-placeholder",style:{display:t.floderChildren.length%2!==0?"block":"none",flex:1}})],2)},T=[];const k={data(){return{iconSize:"35px",timer:""}},computed:{loading(){return this.$store.getters["templateLibrary/loading"]},currentFloder(){return this.$store.getters["templateLibrary/currentFloder"]},floderChildren(){return this.currentFloder.children},currentScene(){return this.$store.getters["scene/currentScene"]},selected(){return this.$store.getters["templateLibrary/selected"]}},methods:{chouseFile(t){t.dir&&this.$store.commit("templateLibrary/currentFloder",t)},remove(t){return this.$tool.devTips()},async useTemplate(t){const o=this.$message.loading("正在应用模板...");let e=d.clone(t.template);delete e.renderer,delete e.controls,delete e.scene,e=await this.$store.dispatch("assetsTransform",e);const a=[];let r={};e=new x(e).pipe(s=>{let{config:i,detail:c}=g.clone(s,{detail:!0,filter:["canvas","component","assets","shaderAssets","canvasAssets"]});if(r=c,i.canvas){let p=JSON.stringify(i,d.stringify);i.canvas.forEach(m=>{const h=C();p=p.replace(new RegExp(m.$cid,"g"),h),c[m.$cid]=h}),i=JSON.parse(p,d.parse)}return i}).pipe(s=>{let i=JSON.stringify(s,d.c);return s.component.forEach(c=>{const p=C(),m=c.$cid;r[c.$cid]=p,c.$cid=p,i=i.replace(new RegExp(m,"g"),p)}),JSON.parse(i,d.parse)}).pipe(s=>(Object.keys(s).forEach(i=>{N(i)&&Object.values(s[i]).forEach(c=>{c.parent===_(u.SCENE)&&(c.parent="",a.push(c.vid))})}),s)).pipe(s=>g.handler(s,i=>O(i.type,i,{strict:!1}),{filter:["canvas","component","assets","shaderAssets","canvasAssets"]})).get();let n=t.editor;n=new x(n).pipe(s=>(s=JSON.stringify(s),Object.keys(r).forEach(i=>{s=s.replace(new RegExp(i,"g"),r[i])}),JSON.parse(s))).get(),f.loadConfigAsync(e).then(s=>{s.component.forEach(i=>{this.$store.commit("component/add",{config:i.config,configuration:i.packageJSON.configuration})}),s.shaders.forEach(i=>{this.$store.commit("shader/add",{vid:i.config.vid,configuration:i.packageJSON.configuration})}),s.canvas.forEach(i=>{this.$store.commit("canvas/add",{config:i.config,configuration:i.packageJSON.configuration})}),this.currentScene.children.push(...a),this.$store.commit("notifyAll"),this.$store.dispatch("appendTemplateInit",n)}).finally(()=>{o.close()})},async updateTempalte(t){console.log(t);const o=this.$message.loading("正在更新模板...");let e=await this.$store.dispatch("urlTransform",f.exportConfig());const a=await this.$store.dispatch("exportConfig");e[l.CONTROLS]&&delete e[l.CONTROLS],e[l.RENDERER]&&delete e[l.RENDERER],e[l.SCENE]&&delete e[l.SCENE],e[l.PASS]&&delete e[l.PASS],e[l.LIGHT]&&e[l.LIGHT].forEach((r,n,s)=>{[u.AMBIENTLIGHT,u.DIRECTIONALLIGHT,u.HEMISPHERELIGHT].includes(r.type)&&s.splice(n,1)}),w.modifyTemplate({id:t.id,name:t.name,template:e,editor:a,preview:await f.getScreenshot({width:960,height:540})}).then(r=>{r.status===200&&(this.$message.success("保存成功！"),this.templateName="",this.templateVisible=!1)}).finally(()=>{o.close()})}}},y={};var L=S(k,$,T,!1,R,"4f965e26",null,null);function R(t){for(let o in y)this[o]=y[o]}const J=function(){return L.exports}();export{J as default};
