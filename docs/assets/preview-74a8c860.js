import{m as R,o as M,p as A,W as P,q as D,r as O,v as T,w as k,x as j,y as z,z as U,A as F,B as W,G,H as I,I as J,J as N,K as V,Q as q,S as B,T as H,U as K,Z as X,_ as Q,$ as Z,a0 as Y,a1 as ee,a2 as se,a3 as te,a4 as ae,V as g,n as _,au as re,a6 as ne,af as $,aa as oe,ad as ie,a7 as le,ab as ce,a8 as de,ai as ue,a9 as pe,av as b,E as ge}from"./index-2dfd5781.js";import"./three-c85558b8.js";class _e extends R{constructor(){super();for(const s of Object.values(M))this.registModule(s);for(const s of Object.values(A))this.resourceManager.addParser(new s);this.install(P({antialias:!0,alpha:!0})).install(D()).install(O()).install(T({MSAA:!0})).install(k()).install(j()),this.exec(z()).exec(U()).exec(F()).exec(W()).exec(G()).exec(I()).exec(J()).exec(N()).exec(V())}}Object.values(q).forEach(e=>{B.register(e)});Object.values(H).forEach(e=>{K.register(e)});window.VIS={};X({proxy:{expand:g.observable,timing:"before"}});const l=new _e().install(Q()).install(Z()).install(Y()),p=new ee;p.setDRACOLoader(new se);p.setKTX2Loader(new te);p.setMeshoptDecoder(ae);p.dracoLoader.setDecoderPath("plugins/draco/gltf/");l.loaderManager.register("gltf",p).register("glb",p);l.eventManager.recursive=!0;window.VIS.engine=l;var he=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"renderWindow-container"},[t("iframe",{ref:"renderMask",staticClass:"render-mask",attrs:{width:"100%",height:"100%",scrolling:"no"}}),t("div",{ref:"renderElement",staticClass:"render-window",attrs:{tabindex:"0"}})])},ve=[];const me={data(){return{timer:"",canResize:!0,throttleTime:1e3/60}},async mounted(){l.setDom(this.$refs.renderElement).setSize().play(),this.$watch("play",a=>{a?l.play():l.stop()},{immediate:!0});const e=this.$refs.renderMask;e.contentWindow.addEventListener("resize",a=>{if(this.canResize)this.canResize=!1,this.timer=setTimeout(()=>{l.setSize(e.offsetWidth,e.offsetHeight),this.canResize=!0},this.throttleTime);else return!1});const s=this.$loading({text:"正在初始化项目...",background:"rgba(0, 0, 0, 0.3)"}),u=re(window.location.href,!0).query.id;u||(this.$message.warning("地址不正确！"),s.close(),window.close());let r=(await ne.getApp(u).catch(a=>{this.$message.error(a),s.close()})).app||{};delete r.helper;let n=JSON.stringify(r,$.stringify);!r.assets&&(r.assets=[]),!r.canvasAssets&&(r.canvasAssets=[]);const h=[];r.assets.forEach(a=>{a.module==="model"?h.push(new Promise((c,d)=>{oe.getModel(a.id).then(o=>{const i=URL.createObjectURL(o.model);n=n.replace(new RegExp(`<${a.module}-${a.id}>`,"g"),i),c({url:i,ext:o.ext})}).catch(d)})):a.module==="texture"&&h.push(new Promise((c,d)=>{ie.getTexture(a.id).then(o=>{const i=URL.createObjectURL(o.texture);n=n.replace(new RegExp(`<${a.module}-${a.id}>`,"g"),i),c({url:i,ext:o.ext})}).catch(d)}))});const m=[];r.canvasAssets.forEach(a=>{m.push(new Promise((c,d)=>{le.getCanvas(a.id).then(o=>{const i=URL.createObjectURL(o.canvas);n=n.replace(new RegExp(`<${a.module}-${a.id}>`,"g"),i),c({url:i,file:o})}).catch(d)}))});const f=[];r.shaderAssets.forEach(a=>{f.push(new Promise((c,d)=>{ce.getShader(a.id).then(o=>{const i=URL.createObjectURL(o.shader);n=n.replace(new RegExp(`<${a.module}-${a.id}>`,"g"),i),c({url:i,pkg:o.pkg,file:o})}).catch(d)}))}),!r.component&&(r.component=[]);const w=[];r.component.forEach(a=>{const[c,d]=a.$url.slice(1,-1).split("-");w.push(new Promise((o,i)=>{de.getComponent(d).then(S=>{const y=URL.createObjectURL(S.component);n=n.replace(new RegExp(`<${c}-${d}>`,"g"),y),a.$url=y,a.$pkg=S.pkg,o(a)})}))}),r.assets=await Promise.all(h),r.canvasAssets=await Promise.all(m),r.shaderAssets=await Promise.all(f),r.component=await Promise.all(w),n=JSON.parse(n,$.parse),n.assets=r.assets,n.canvasAssets=r.canvasAssets,n.shaderAssets=r.shaderAssets,n.component=r.component,n.canvas&&n.canvas.forEach(a=>{a.$pkg=r.canvasAssets.find(c=>c.url===a.$url).file.pkg}),r=n,r=ue.handler(r,a=>pe(a.type,a,{strict:!1}),{filter:["assets","component","canvasAssets","canvas","shaderAssets"]}),await l.loadConfigAsync(r),l.setSceneBySymbol(r.scene[0].vid),r.camera[0]&&l.setCameraBySymbol(r.camera[0].vid),l.play(),s.close()},methods:{}},x={};var fe=_(me,he,ve,!1,we,"0eeb8900",null,null);function we(e){for(let s in x)this[s]=x[s]}const Se=function(){return fe.exports}();var ye=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"icon-container",style:{"font-size":e.size,color:e.color}},[t("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":e.code}})])])},$e=[];const xe={name:"VisIcon",props:{code:{type:String},size:{type:String},color:{type:String}},data(){return{}},mounted(){},beforeDestroy(){}},C={};var Ce=_(xe,ye,$e,!1,Le,null,null,null);function Le(e){for(let s in C)this[s]=C[s]}const Ee=function(){return Ce.exports}();var be=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.showLoading,expression:"showLoading"}],staticClass:"loadingManager-container"},[t("div",{staticClass:"loadingManage-main"},[e.loadError?t("div",{staticClass:"loadingManager-close",on:{click:e.close}},[t("vis-icon",{attrs:{code:"#iconguanbi"}})],1):e._e(),t("div",{staticClass:"progress-title"},[t("vis-icon",{attrs:{code:"#iconwenjian"}}),e._v(" 正在加载："+e._s(e.title)+" ")],1),t("div",{staticClass:"overall-progress-box"},[t("div",{staticClass:"overall-progress"},[t("div",{staticClass:"overall-progress-main",style:{width:`${e.overllProgress}%`,backgroundColor:e.loadError?"#FF4C4C":null}})]),t("span",{staticClass:"overall-number",domProps:{textContent:e._s(`${e.loadSuccess}/${e.loadTotal}`)}})]),t("div",{staticClass:"detail-progress-box"},[t("div",{staticClass:"detail-title",on:{click:function(){e.showDetail=!e.showDetail}}},[t("span",[e._v("展示详情")]),t("vis-icon",{style:{transform:e.showDetail?"rotate(0)":"rotate(-90deg)"},attrs:{code:"#iconxiala"}})],1),e.showDetail?t("div",{staticClass:"detail-message"},e._l(e.loadDetailMap,function(u,v){return t("div",{key:v,staticClass:"detail-item",style:{color:u.error?"#FF4C4C":null}},[t("span",{staticClass:"detail-url",domProps:{textContent:e._s(u.url)}}),u.error?t("span",{domProps:{textContent:e._s(u.message)}}):[t("span",{staticClass:"detail-seat"}),t("span",{staticClass:"detail-number",domProps:{textContent:e._s(`${u.progress*100}%`)}})]],2)}),0):e._e()])])])},Re=[];const Me={components:{visIcon:Ee},data(){return{showLoading:!1,showDetail:!0,title:"",loadTotal:0,loadSuccess:0,loadError:0,loadDetailMap:{}}},computed:{overllProgress(){return this.loadTotal===0?0:this.loadSuccess/this.loadTotal*100}},mounted(){const e=l.loaderManager;e.addEventListener("beforeLoad",s=>{!this.showLoading&&(this.showLoading=!0)}),e.addEventListener("loading",s=>{!this.showLoading&&(this.showLoading=!0),this.loadTotal=s.loadTotal,this.loadSuccess=s.loadSuccess,this.loadError=s.loadError}),e.addEventListener("loaded",s=>{this.loadTotal=s.loadTotal,this.loadSuccess=s.loadSuccess,this.loadError=s.loadError,setTimeout(()=>{this.showLoading=!1},1e3)}),e.addEventListener("detailLoaded",s=>{this.title=s.url,this.loadDetailMap=e.getLoadDetailMap()})},methods:{close(){this.showLoading=!1}}},L={};var Ae=_(Me,be,Re,!1,Pe,"146aa0de",null,null);function Pe(e){for(let s in L)this[s]=L[s]}const De=function(){return Ae.exports}();var Oe=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{attrs:{id:"app"}},[t("render-window"),t("loading-manager")],1)},Te=[];const ke={components:{renderWindow:Se,loadingManager:De},mounted(){}},E={};var je=_(ke,Oe,Te,!1,ze,"c87061ee",null,null);function ze(e){for(let s in E)this[s]=E[s]}const Ue=function(){return je.exports}();b.start();g.config.productionTip=!1;g.use(ge);new g({mounted(){b.done()},render:e=>e(Ue)}).$mount("#app");
