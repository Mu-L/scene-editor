var E=Object.defineProperty;var b=(t,s,e)=>s in t?E(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var g=(t,s,e)=>(b(t,typeof s!="symbol"?s+"":s,e),e);import{n as S,af as d,ai as v,ah as C,az as N,u as _,i as u,a9 as O,M as c}from"./texture-7d506f8b.js";import{e as f,c as w}from"./index-74278c3c.js";import"./three-c85558b8.js";class x{constructor(s){g(this,"config");this.config=s}pipe(s){return this.config=s(this.config),this}get(){return this.config}}var $=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"containerOperation-container"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"loading-mask"},[e("vis-icon",{staticClass:"ani",attrs:{code:"#iconxuanzhuan"}}),e("span",[t._v("正在加载...")])],1),!t.loading&&!t.floderChildren.length?e("div",{staticClass:"empty-tips"},[e("span",[t._v("这里暂时是空的哦")])]):t._l(t.floderChildren,function(a,r){return e("div",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:`${a.name}`,expression:"`${item.name}`",modifiers:{bottom:!0}}],key:r,staticClass:"file-item-box"},[a.dir?[e("vis-icon",{attrs:{size:t.iconSize,code:"#iconwenjianjia"}})]:[e("img",{attrs:{src:a.preview}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.selected.id===a.id,expression:"selected.id === item.id"}],staticClass:"item-selected-mask",on:{click:function(n){return n.stopPropagation(),t.$store.commit("templateLibrary/cancelSelected")}}},[e("vis-icon",{staticClass:"item-selected",attrs:{size:"60px",code:"#icongou"}})],1)],e("span",{staticClass:"item-title",domProps:{textContent:t._s(a.name)}}),a.dir?e("span",{staticClass:"item-operate-box"},[e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"移动",expression:"`移动`",modifiers:{bottom:!0}}],attrs:{size:"20px",code:"#iconpingyi"}}),e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"打开",expression:"`打开`",modifiers:{bottom:!0}}],attrs:{size:"20px",code:"#iconyidong"},nativeOn:{click:function(n){return n.stopPropagation(),t.chouseFile(a)}}}),e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"删除",expression:"`删除`",modifiers:{bottom:!0}}],staticClass:"item-delete",attrs:{size:"16px",code:"#iconshanchu"},nativeOn:{click:function(n){return n.stopPropagation(),t.remove(a)}}})],1):e("span",{staticClass:"item-operate-box"},[e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"更新",expression:"`更新`",modifiers:{bottom:!0}}],attrs:{size:"16px",code:"#iconxuanzhuan"},nativeOn:{click:function(n){return n.stopPropagation(),t.updateTempalte(a)}}}),e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"应用",expression:"`应用`",modifiers:{bottom:!0}}],attrs:{size:"20px",code:"#iconyingyong"},nativeOn:{click:function(n){return n.stopPropagation(),t.useTemplate(a)}}}),e("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"删除",expression:"`删除`",modifiers:{bottom:!0}}],staticClass:"item-delete",attrs:{size:"16px",code:"#iconshanchu"},nativeOn:{click:function(n){return n.stopPropagation(),t.remove(a)}}})],1)],2)}),e("div",{staticClass:"file-item-placeholder",style:{display:t.floderChildren.length%2!==0?"block":"none",flex:1}})],2)},T=[];const k={data(){return{iconSize:"35px",timer:""}},computed:{loading(){return this.$store.getters["templateLibrary/loading"]},currentFloder(){return this.$store.getters["templateLibrary/currentFloder"]},floderChildren(){return this.currentFloder.children},currentScene(){return this.$store.getters["scene/currentScene"]},selected(){return this.$store.getters["templateLibrary/selected"]}},methods:{chouseFile(t){t.dir&&this.$store.commit("templateLibrary/currentFloder",t)},remove(t){},async useTemplate(t){const s=this.$message.loading("正在应用模板...");let e=d.clone(t.template);delete e.renderer,delete e.controls,delete e.scene,e=await this.$store.dispatch("assetsTransform",e);const a=[];let r={};e=new x(e).pipe(o=>{let{config:i,detail:l}=v.clone(o,{detail:!0,filter:["canvas","component","assets","shaderAssets","canvasAssets"]});if(r=l,i.canvas){let p=JSON.stringify(i,d.stringify);i.canvas.forEach(m=>{const h=C();p=p.replace(new RegExp(m.$cid,"g"),h),l[m.$cid]=h}),i=JSON.parse(p,d.parse)}return i}).pipe(o=>{let i=JSON.stringify(o,d.c);return o.component.forEach(l=>{const p=C(),m=l.$cid;r[l.$cid]=p,l.$cid=p,i=i.replace(new RegExp(m,"g"),p)}),JSON.parse(i,d.parse)}).pipe(o=>(Object.keys(o).forEach(i=>{N(i)&&Object.values(o[i]).forEach(l=>{l.parent===_(u.SCENE)&&a.push(l.vid)})}),o)).pipe(o=>v.handler(o,i=>O(i.type,i,{strict:!1}),{filter:["canvas","component","assets","shaderAssets","canvasAssets"]})).get();let n=t.editor;n=new x(n).pipe(o=>(o=JSON.stringify(o),Object.keys(r).forEach(i=>{o=o.replace(new RegExp(i,"g"),r[i])}),JSON.parse(o))).get(),f.loadConfigAsync(e).then(o=>{o.component.forEach(i=>{this.$store.commit("component/add",{config:i.config,configuration:i.packageJSON.configuration})}),o.shaders.forEach(i=>{this.$store.commit("shader/add",{vid:i.config.vid,configuration:i.packageJSON.configuration})}),o.canvas.forEach(i=>{this.$store.commit("canvas/add",{config:i.config,configuration:i.packageJSON.configuration})}),this.currentScene.children.push(...a),this.$store.commit("notifyAll"),this.$store.dispatch("appendTemplateInit",n)}).finally(()=>{s.close()})},async updateTempalte(t){console.log(t);const s=this.$message.loading("正在更新模板...");let e=await this.$store.dispatch("urlTransform",f.exportConfig());const a=await this.$store.dispatch("exportConfig");e[c.CONTROLS]&&delete e[c.CONTROLS],e[c.RENDERER]&&delete e[c.RENDERER],e[c.SCENE]&&delete e[c.SCENE],e[c.PASS]&&delete e[c.PASS],e[c.LIGHT]&&e[c.LIGHT].forEach((r,n,o)=>{[u.AMBIENTLIGHT,u.DIRECTIONALLIGHT,u.HEMISPHERELIGHT].includes(r.type)&&o.splice(n,1)}),w.modifyTemplate({id:t.id,name:t.name,template:e,editor:a,preview:await f.getScreenshot({width:960,height:540})}).then(r=>{r.status===200&&(this.$message.success("保存成功！"),this.templateName="",this.templateVisible=!1)}).finally(()=>{s.close()})}}},y={};var z=S(k,$,T,!1,L,"665f3cfb",null,null);function L(t){for(let s in y)this[s]=y[s]}const J=function(){return z.exports}();export{J as default};
