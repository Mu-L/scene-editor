import{n as f,_ as W}from"./index-63b3abee.js";import"./three-2ccf5448.js";var b=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"viewTrack-container"},[e("div",{staticClass:"viewTrack-track"},[e("div",{staticClass:"track-scroll",style:{left:`${t.scrollBarLeft}%`,width:`${t.scrollBarWidth}%`}},[e("div",{staticClass:"scroll-arrow",on:{mousedown:t.stretchLeft}}),e("div",{staticClass:"scroll-bar",on:{mousedown:t.scrollTrack}}),e("div",{staticClass:"scroll-arrow",on:{mousedown:t.stretchRight}})])]),e("div",{staticClass:"viewTrack-veiw"},[e("div",{staticClass:"viewTrack-exact",style:{width:`${t.exactWidth}px`,left:`${t.exactOffset}px`}},[e("div",{staticClass:"viewTrack-exact-slot"},[t._t("default",null,{exactWidth:t.exactWidth})],2)])])])},x=[];const F={data(){return{scrollBarLeft:0,scrollBarWidth:100,bufferScrollLeft:0,bufferScrollWidth:100,throttleTime:1e3/30,stretchLeftTimer:"",stretchLeftCanMove:!0,stretchRightTimer:"",stretchRightCanMove:!0,scrollTimer:"",scrollCanMove:!0}},computed:{trackWidth(){return this.$store.getters["animation/trackWidth"]},exactWidth(){return(this.trackWidth-20)/(this.scrollBarWidth/100)},exactOffset(){return-this.exactWidth*this.scrollBarLeft/100}},methods:{checkScrollWidth(){const t=20/this.trackWidth*100,r=100-this.scrollBarLeft;this.scrollBarWidth<t?this.scrollBarWidth=t:this.scrollBarWidth>r&&(this.scrollBarWidth=r)},checkOffset(){const r=100-this.scrollBarWidth;this.scrollBarLeft<0?this.scrollBarLeft=0:this.scrollBarLeft>r&&(this.scrollBarLeft=r)},stretchLeft(t){const r=s=>{if(document.body.style.cursor="ew-resize",this.stretchLeftCanMove)this.stretchLeftTimer=setTimeout(()=>{const o=s.clientX-t.clientX;this.scrollBarLeft=this.bufferScrollLeft+o/this.trackWidth*100,this.checkOffset(),this.scrollBarWidth=this.bufferScrollWidth-o/this.trackWidth*100,this.checkScrollWidth(),this.stretchLeftTimer=!0},this.throttleTime);else return!1},e=()=>{document.body.style.cursor="default",this.bufferScrollWidth=this.scrollBarWidth,this.bufferScrollLeft=this.scrollBarLeft,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",e)},stretchRight(t){const r=s=>{if(document.body.style.cursor="ew-resize",this.stretchRightCanMove)this.stretchRightTimer=setTimeout(()=>{const o=s.clientX-t.clientX;this.scrollBarWidth=this.bufferScrollWidth+o/this.trackWidth*100,this.checkScrollWidth(),this.stretchRightTimer=!0},this.throttleTime);else return!1},e=()=>{document.body.style.cursor="default",this.bufferScrollWidth=this.scrollBarWidth,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",e)},scrollTrack(t){const r=s=>{if(document.body.style.cursor="pointer",this.scrollCanMove)this.scrollTimer=setTimeout(()=>{const o=s.clientX-t.clientX;this.scrollBarLeft=this.bufferScrollLeft+o/this.trackWidth*100,this.checkOffset(),this.scrollTimer=!0},this.throttleTime);else return!1},e=()=>{document.body.style.cursor="default",this.bufferScrollLeft=this.scrollBarLeft,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",e)}}},p={};var T=f(F,b,x,!1,$,"71b74335",null,null);function $(t){for(let r in p)this[r]=p[r]}const E=function(){return T.exports}();var M=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"timeAxis-conatainer"},[e("div",{staticClass:"timeAxis-keyframe-list",on:{click:t.jumpTime}},t._l(t.timeKeyframeList,function(s,o){return e("div",{key:o,staticClass:"timeAxis-keyframe",style:{left:`${s.position}%`}},[e("div",{staticClass:"time",domProps:{textContent:t._s(s.text)}}),e("div",{staticClass:"axis"},[t._v("|")])])}),0),e("div",{staticClass:"timeAxis-pointer",style:{left:`${t.pointerPosition}%`},on:{mousedown:t.pointerMousedown}},[e("div",{staticClass:"pointer-header"},[e("vis-icon",{attrs:{code:"#iconzhencopy",color:"yellow"}})],1)])])},C=[];const k={props:{exactWidth:{type:Number,required:!0}},data(){return{visualMaxTimeQuantum:24,timeKeyframeList:[],timer:"",bufferCurrentFrame:0,canMove:!0}},computed:{trackWidth(){return this.$store.getters["animation/trackWidth"]},fps(){return this.$store.getters["animation/fps"]},totalDuration(){return this.$store.getters["animation/totalDuration"]},totalFrame(){return this.$store.getters["animation/totalFrame"]},currentFrame(){return this.$store.getters["animation/currentFrame"]},timekeyFrameMultiplyList(){const t=[1,2,5,10],r=t.concat([]),e=this.fps,s=e,o=e*60;return r.push(s*.5),t.forEach(i=>{r.push(i*s)}),r.push(o*.5),t.forEach(i=>{r.push(i*o)}),r},currentMutiply(){const t=this.timekeyFrameMultiplyList,r=this.totalDuration*this.fps,e=this.exactWidth,s=this.trackWidth/this.visualMaxTimeQuantum;let o=1;return t.some(i=>{const n=r/i;if(e/n>=s)return o=i,!0}),o},pointerPosition(){return this.currentFrame/this.totalFrame*100}},methods:{pointerMousedown(t){const r=this.exactWidth/(this.totalDuration*this.fps);this.bufferCurrentFrame=this.currentFrame;const e=o=>{if(document.body.style.cursor="ew-resize",this.canMove)this.timer=setTimeout(()=>{const i=o.clientX-t.clientX,n=Math.floor(i/r),a=this.bufferCurrentFrame+n;a!==this.currentFrame&&this.$store.commit("animation/currentFrame",a),this.canMove=!0},this.throttleTime);else return!1},s=()=>{document.body.style.cursor="default",document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)},jumpTime(t){const r=t.offsetX/this.exactWidth*this.totalDuration,e=Math.ceil(r*this.fps)-1;this.$store.commit("animation/currentFrame",e)}},watch:{currentMutiply:{handler(t,r){if(t!==r){const e=this.fps,s=this.currentMutiply,o=this.totalDuration*this.fps,i=Math.floor(o/s),n=[],a=c=>{const h=e,u=e*60,v=u*60;let d="",m="",l="";return s<h?(d="f",l=Math.floor(c/h),m=c-l*h):s<u?(d="s",l=Math.floor(c/u),m=(c-l*u)/h):s<v&&(d="m",l=Math.floor(c/v),m=(c-l*v)/u),`${l?l+":":"0:"}${m||0}${d}`};for(let c=0;c<=i;c+=1)n.push({position:c/i*100,text:a(c*s),keyframe:c*s});this.timeKeyframeList=n}},immediate:!0}},created(){this.bufferCurrentFrame=this.currentFrame}},_={};var R=f(k,M,C,!1,g,"58a023b0",null,null);function g(t){for(let r in _)this[r]=_[r]}const S=function(){return R.exports}();var w=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"preRenderArea-container"},[e("div",{staticClass:"preRenderArea-arrow",style:{left:t.arrowLeftOffset},on:{mousedown:t.stretchLeft}}),e("div",{staticClass:"preRenderArea-bar",style:{width:`${t.scrollBarWidth}%`,left:`${t.scrollBarLeft}%`},on:{mousedown:t.scrollTrack}}),e("div",{staticClass:"preRenderArea-ready-box"},t._l(t.totalFrame,function(s,o){return e("div",{key:o,staticClass:"area-ready",class:{ready:t.cacheSignMap[o]},attrs:{"data-ready":o}})}),0),e("div",{staticClass:"preRenderArea-arrow",style:{left:`${t.arrowRightOffset}%`},on:{mousedown:t.stretchRight}})])},B=[];const X={props:{exactWidth:{type:Number,required:!0}},data(){return{bufferRenderStart:"",bufferRenderEnd:"",bufferScrollFrame:0,throttleTime:1e3/30,stretchLeftTimer:"",stretchLeftCanMove:!0,stretchRightTimer:"",stretchRightCanMove:!0,scrollTimer:"",scrollCanMove:!0}},computed:{renderStart(){return this.$store.getters["preRenderArea/renderStart"]},renderEnd(){return this.$store.getters["preRenderArea/renderEnd"]},cacheSignMap(){return this.$store.getters["preRenderArea/cacheSignMap"]},scrollBarLeft(){return this.renderStart/this.totalFrame*100},scrollBarWidth(){return(this.renderEnd-this.renderStart)/this.totalFrame*100},arrowLeftOffset(){return`calc(${this.scrollBarLeft}% - 10px)`},arrowRightOffset(){return this.renderEnd/this.totalFrame*100},fps(){return this.$store.getters["animation/fps"]},totalFrame(){return this.$store.getters["animation/totalFrame"]},totalDuration(){return this.$store.getters["animation/totalDuration"]}},methods:{stretchLeft(t){this.bufferRenderStart=this.renderStart;const r=this.exactWidth/(this.totalDuration*this.fps),e=o=>{if(document.body.style.cursor="ew-resize",this.stretchLeftCanMove)this.stretchLeftTimer=setTimeout(()=>{const i=o.clientX-t.clientX,n=Math.floor(i/r);this.$store.commit("preRenderArea/renderStart",this.bufferRenderStart+n),this.stretchLeftCanMove=!0},this.throttleTime);else return!1},s=()=>{document.body.style.cursor="default",document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)},stretchRight(t){this.bufferRenderEnd=this.renderEnd;const r=this.exactWidth/(this.totalDuration*this.fps),e=o=>{if(document.body.style.cursor="ew-resize",this.stretchRightCanMove)this.stretchRightTimer=setTimeout(()=>{const i=o.clientX-t.clientX,n=Math.floor(i/r);this.$store.commit("preRenderArea/renderEnd",this.bufferRenderEnd+n),this.stretchRightCanMove=!0},this.throttleTime);else return!1},s=()=>{document.body.style.cursor="default",this.bufferScrollWidth=this.scrollBarWidth,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)},scrollTrack(t){this.bufferScrollFrame=0,this.bufferRenderEnd=this.renderEnd,this.bufferRenderStart=this.renderStart;const r=this.exactWidth/(this.totalDuration*this.fps),e=o=>{if(document.body.style.cursor="pointer",this.scrollCanMove)this.scrollTimer=setTimeout(()=>{const i=o.clientX-t.clientX,n=Math.floor(i/r),a=n-this.bufferScrollFrame;if(this.renderStart<=0&&a<0||this.renderEnd>=this.totalFrame&&a>0)return!1;this.$store.commit("preRenderArea/renderStart",this.bufferRenderStart+n),this.$store.commit("preRenderArea/renderEnd",this.bufferRenderEnd+n),this.bufferScrollFrame=n,this.scrollCanMove=!0},this.throttleTime);else return!1},s=()=>{document.body.style.cursor="default",document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)}}},y={};var A=f(X,w,B,!1,D,"61eef344",null,null);function D(t){for(let r in y)this[r]=y[r]}const K=function(){return A.exports}();var N=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"trackController-container"},[e("view-track",{scopedSlots:t._u([{key:"default",fn:function(s){var o=s.exactWidth;return[e("time-axis",{attrs:{exactWidth:o}}),e("pre-render-area",{attrs:{exactWidth:o}}),e("animation-track",{attrs:{scrollTop:t.scrollTop}})]}}])})],1)},O=[];const z=()=>W(()=>import("./animationTrack-1171a7b2.js"),["assets/animationTrack-1171a7b2.js","assets/aniScriptLibrary-75c9e81e.js","assets/index-63b3abee.js","assets/three-2ccf5448.js","assets/index-cd05e7bc.css","assets/animationTrack-dedca771.css"]),j={components:{viewTrack:E,timeAxis:S,preRenderArea:K,animationTrack:z},props:{scrollTop:{type:Number,default:0}}},L={};var P=f(j,N,O,!1,q,"3f38e814",null,null);function q(t){for(let r in L)this[r]=L[r]}const I=function(){return P.exports}();export{I as default};
