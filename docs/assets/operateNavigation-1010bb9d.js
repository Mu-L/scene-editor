import{n as u,e as c,J as h,a as g}from"./index-63b3abee.js";import"./three-2ccf5448.js";var p=function(){var e=this,o=e.$createElement,s=e._self._c||o;return s("div",{staticClass:"operateNavigation-container"},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.screenshotDialogVisible=!0}}},[e._v(" 快照 ")]),s("el-button",{attrs:{size:"mini",type:"success"},on:{click:e.save}},[e._v("保存")]),s("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.display}},[e._v("展示")]),s("el-dialog",{attrs:{title:"快照设置",visible:e.screenshotDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.screenshotDialogVisible=t}}},[s("el-form",{attrs:{"label-position":"left","label-width":"90px"}},[s("el-form-item",{attrs:{label:"文件名"}},[s("el-input",{attrs:{size:"mini"},model:{value:e.screenshotSetting.name,callback:function(t){e.$set(e.screenshotSetting,"name",t)},expression:"screenshotSetting.name"}})],1),s("el-form-item",{attrs:{label:"宽度（px）"}},[s("el-input-number",{attrs:{size:"mini",controls:!1},model:{value:e.screenshotSetting.width,callback:function(t){e.$set(e.screenshotSetting,"width",t)},expression:"screenshotSetting.width"}})],1),s("el-form-item",{attrs:{label:"高度（px）"}},[s("el-input-number",{attrs:{size:"mini",controls:!1},model:{value:e.screenshotSetting.height,callback:function(t){e.$set(e.screenshotSetting,"height",t)},expression:"screenshotSetting.height"}})],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.screenshotDialogVisible=!1}}},[e._v(" 取 消 ")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getScreenshot}},[e._v(" 确 定 ")])],1)],1)],1)},m=[];const f={data(){return{screenshotDialogVisible:!1,buildDialogVisible:!1,screenshotSetting:{width:1920,height:1080,name:"vis-screenshot"},exportSetting:{name:"vis-scene"}}},computed:{name(){return this.$store.getters.name},id(){return this.$store.getters.id}},methods:{async getScreenshot(){const e=await c.getScreenshot({width:this.screenshotSetting.width,height:this.screenshotSetting.height}),o=document.createElement("a");o.download=this.screenshotSetting.name,o.href=e,o.click(),this.screenshotDialogVisible=!1,this.screenshotSetting={width:1920,height:1080,name:"vis-screenshot"}},async save(){const e=this.$loading({text:"正在保存...",background:"rgb(0, 0, 0)",target:".renderWindow-container"}),o=await this.$store.dispatch("exportConfig"),s=await c.getScreenshot({width:1920,height:1080});let t=c.exportConfig(),r=JSON.stringify(t,h.stringify);const l=this.$store.getters.urlDetails;t.assets=t.assets.map(i=>{const n={id:null,module:null};if(!l[i.url])this.$message.console.error(`导出失败，未找到相关资源缓存：${i.url}`);else{const a=l[i.url];n.id=a.id,n.module=a.model?"model":a.texture?"texture":null,r=r.replace(new RegExp(i.url,"g"),`<${n.module}-${n.id}>`)}return n}),t.component.forEach(i=>{const n={id:null,module:"component"};if(!l[i.$url])this.$message.error(`导出失败，未找到相关资源缓存：${i.$url}`);else{const a=l[i.$url];n.id=a.id,r=r.replace(new RegExp(i.$url,"g"),`<${n.module}-${n.id}>`)}i.$url=`<${n.module}-${n.id}>`}),r=JSON.parse(r,h.parse),r.assets=t.assets,t=r,console.log(t),g.saveApp({id:this.id,name:this.name,app:t,editor:o,preview:s}).then(i=>{console.log(i),this.$message.success("保存成功！")}).finally(()=>{e.close()})},display(){window.open(window.location.origin+window.location.pathname+`/preview.html?id=${this.id}`)},download(){const e=document.createElement("a");e.download=`${this.$store.getters.name}.zip`,e.href=`/app/${this.$store.getters.id}/dist.zip`,e.click()}},mounted(){c.keyboardManager.register({shortcutKey:["ctrl","s"],desp:"在线保存",keydown:e=>{e.preventDefault(),e.stopPropagation(),this.save()}})}},d={};var v=u(f,p,m,!1,$,"4c0f012c",null,null);function $(e){for(let o in d)this[o]=d[o]}const w=function(){return v.exports}();export{w as default};
