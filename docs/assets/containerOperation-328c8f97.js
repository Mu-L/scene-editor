import{n as m,e as a,p as c,g as d,V as h}from"./index-9c012ccb.js";import"./three-6daa312a.js";var u=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"containerOperation-container"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"loading-mask"},[o("vis-icon",{staticClass:"ani",attrs:{code:"#iconxuanzhuan"}}),o("span",[e._v("正在加载...")])],1),!e.loading&&!e.floderChildren.length?o("div",{staticClass:"empty-tips"},[o("span",[e._v("这里暂时是空的哦")])]):e._l(e.floderChildren,function(s,n){return o("div",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:`${s.name}`,expression:"`${item.name}`",modifiers:{bottom:!0}}],key:n,staticClass:"file-item-box",class:{active:!1},on:{click:function(i){return e.chouseFile(s)}}},[s.dir?[o("vis-icon",{attrs:{size:e.iconSize,code:"#iconwenjianjia"}})]:[o("img",{attrs:{src:s.preview}})],o("span",{staticClass:"item-title",domProps:{textContent:e._s(s.name)}}),o("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:"删除",expression:"`删除`",modifiers:{bottom:!0}}],staticClass:"item-delete",attrs:{size:"16px",code:"#iconshanchu"},nativeOn:{click:function(i){return i.stopPropagation(),e.remove(s)}}})],2)}),o("div",{staticClass:"file-item-placeholder",style:{display:e.floderChildren.length%2!==0?"block":"none",flex:1}})],2)},f=[];const p={data(){return{iconSize:"35px",timer:"",fileIcon:{mtl:"#iconmtl"},configTemplateCache:{},configRootCache:{}}},computed:{loading(){return this.$store.getters["modelLibrary/loading"]},currentFloder(){return this.$store.getters["modelLibrary/currentFloder"]},floderChildren(){return this.currentFloder.children},currentScene(){return this.$store.getters["scene/currentScene"]},urls(){return this.$store.getters["modelLibrary/urls"]}},methods:{chouseFile(e){e.dir?this.$store.commit("modelLibrary/currentFloder",e):this.modelSelected(e)},modelSelected(e){console.log(e);let t=this.urls.get(e);if(t||(t=URL.createObjectURL(e.model),this.$store.commit("modelLibrary/cacheUrl",{file:e,url:t})),console.log(t),!this.configTemplateCache[t])a.loadResourcesAsync([{url:t,ext:e.ext}]).then(o=>{this.configTemplateCache[t]=o.resourceConfig[t];const s=[t,t+".scene"];for(const n of s)if(o.configMap.has(n)){const i=o.configMap.get(n);i.name=e.name,this.configRootCache[t]=i.vid;break}if(!this.configTemplateCache[t]){this.$message.error("加载模型失败！");return}if(!this.configRootCache[t]){this.$message.error("获取模型根元素失败！");return}this.modelSelected(e)});else{const o=this.configTemplateCache[t],{config:s,detail:n}=c.clone(o,{detail:!0,fillName:!0}),i=c.handler(s,r=>d(r.type,r));a.loadConfigAsync(h.observable(i)).then(r=>{this.configRootCache[t]&&(this.$store.commit("notifyAll"),this.$nextTick(()=>{this.currentScene.children.push(n[this.configRootCache[t]])}))})}},remove(e){e.dir?this.$confirm(`是否删除此分类: ${e.name}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.axios.post("/model/removeClassify",{id:e.id}).then(t=>{t.status===200?(this.$message({type:"success",message:"删除成功!"}),this.$store.commit("modelLibrary/removeChildren",e)):this.$message.error(t.message)})}):this.$confirm(`是否删除此模型: ${e.name}, 删除此模型相关的编辑项目会受到影响，是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.axios.post("/model/removeModel",{id:e.id}).then(t=>{t.status===200?(this.$message({type:"success",message:"删除成功!"}),this.$store.commit("modelLibrary/removeChildren",e)):this.$message.error(t.message)})})}}},l={};var g=m(p,u,f,!1,v,"3aaa6e5c",null,null);function v(e){for(let t in l)this[t]=l[t]}const $=function(){return g.exports}();export{$ as default};
