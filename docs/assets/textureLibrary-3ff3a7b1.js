import{n as p,C as n,e as i,j as c,g as l,l as u,_ as h}from"./index-63b3abee.js";import"./three-2ccf5448.js";var m=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"texture-container"},[t("div",{staticClass:"box-header"},[t("el-input",{attrs:{size:"mini","prefix-icon":"el-icon-search",placeholder:"贴图筛选"}}),t("el-dropdown",{attrs:{trigger:"click"},on:{command:e.addtexture}},[t("el-button",{attrs:{size:"mini",icon:"el-icon-circle-plus-outline",type:"primary"}},[e._v(" 添加贴图 ")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.texture,function(r,o){return t("el-dropdown-item",{key:o,attrs:{command:r},domProps:{textContent:e._s(r.label)}})}),1)],1)],1),t("div",{staticClass:"box-container"},[t("div",{staticClass:"texture-main"},e._l(e.textureList,function(r,o){return t("div",{key:o,staticClass:"texture-elem"},[t("div",{ref:r.vid,refInFor:!0,staticClass:"render-box",class:{active:e.active.vid===r.vid},attrs:{id:r.vid},on:{click:function(){e.$store.commit("texture/setCurrentTexture",r.vid)}}}),t("div",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"删除",expression:"'删除'",modifiers:{top:!0}}],staticClass:"operate-box",on:{click:function(a){return e.deleteTexture(r)}}},[t("vis-icon",{attrs:{code:"#iconshanchu",color:"red"}})],1),t("div",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:r.name,expression:"item.name",modifiers:{bottom:!0}}],staticClass:"element-title",domProps:{textContent:e._s(r.name)}})])}),0)]),t("file-system",{ref:"fileSystem"})],1)},x=[];const f=()=>h(()=>import("./fileSystem-ed835a09.js"),["assets/fileSystem-ed835a09.js","assets/index-63b3abee.js","assets/three-2ccf5448.js","assets/index-cd05e7bc.css","assets/fileSystem-6b34a7b4.css"]),v={components:{fileSystem:f},data(){return{texture:[{icon:"#icontexture",label:"图片贴图",type:n.IMAGETEXTURE},{icon:"#icontexture",label:"视频贴图",type:n.VIDEOTEXTURE},{icon:"#icontexture",label:"盒状贴图",type:n.CUBETEXTURE},{icon:"#icontexture",label:"加载贴图",type:n.LOADTEXTURE}],canvasMap:{},watchMap:{}}},computed:{textureList(){return this.$store.getters["texture/get"]},active(){return this.$store.getters["texture/currentTexture"]},urls(){return this.$store.getters.urls}},methods:{addtexture(e){this.$refs.fileSystem.open({confirm:({files:s})=>{if(console.log(s),e.type===n.CUBETEXTURE){this.loadCubeTexture(s);return}if(e.type===n.LOADTEXTURE){this.loadLoadTexture(s);return}this.loadTexture(s,e.type)}})},loadTexture(e,s){i.loadConfigAsync({assets:e.map(t=>({url:this.urls[`texture-${t.id}`],ext:t.ext}))}).then(t=>{e.forEach(r=>{const o=c(),a=l(s,{vid:o,url:this.urls[`texture-${r.id}`],name:`${r.name}${o.slice(-2)}`});this.$store.commit("texture/add",a)})})},loadCubeTexture(e){const s={px:"",nx:"",py:"",ny:"",pz:"",nz:""},t=Object.keys(s);if(e.forEach(r=>{t.forEach(o=>{r.name.toLocaleLowerCase().includes(o)&&(s[o]=this.urls.get(r))})}),console.log(s),Object.values(s).includes("")){this.$message.warning("贴图素材不完整，需要选择6张相关天空盒贴图！");return}i.loadResourcesAsync(Object.values(s)).then(r=>{const o=c(),a=l(n.CUBETEXTURE,{vid:o,cube:s,name:`盒状贴图-${o.slice(-2)}`});this.$store.commit("texture/add",a)})},loadLoadTexture(e){console.log(e),i.loadConfigAsync({assets:e.map(s=>({url:this.urls[`texture-${s.id}`],ext:s.ext}))}).then(s=>{e.forEach(t=>{const r=i.generateLoadTextureConfig(this.urls[`texture-${t.id}`]);r.name=`${t.name}-${r.vid.slice(-2)}`,console.log(r),this.$store.commit("texture/add",r)})})},updateTextureDisplay(e){u.setTexture(i.compilerManager.getObjectBySymbol(e)).render();let s=new Image;s.src=u.getDataURL();const t=this.canvasMap[e];s.onload=()=>{t.getContext("2d").drawImage(s,0,0,75,55)}},deleteTexture(e){this.$confirm(`是否删除贴图：${e.name}，场景中使用了相关贴图的材质也会受到影响。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.commit("texture/remove",e.vid),this.$delete(this.canvasMap,e.vid);const s=this.watchMap[e.vid];s?s():console.warn("找不到这个vid的监听器",e.vid),this.$delete(this.watchMap,e.vid);let t=0;Object.values(this.$store.getters["material/get"]).forEach(r=>{let o=!1;Object.keys(r).forEach(a=>{a.toLocaleLowerCase().includes("map")&&r[a]===e.vid&&(r[a]="",o=!0)}),o&&(t+=1)}),this.$message({type:"success",message:`删除成功! 影响了：${t} 个材质。`})})}},watch:{textureList:{handler(e,s){this.$nextTick(()=>{Object.keys(e).forEach(t=>{if(!this.$refs[t])return console.error(`can not found this dom: '${t}'`),!1;if(this.canvasMap[t])return!1;const r=this.$refs[t][0],o=document.createElement("canvas");o.setAttribute("width",75),o.setAttribute("height",55),r.appendChild(o),this.canvasMap[t]=o,this.watchMap[t]=this.$watch(function(){return this.textureList[t]},a=>{this.updateTextureDisplay(t)},{deep:!0,immediate:!0})})})},immediate:!0}}},d={};var _=p(v,m,x,!1,g,"fa2c916a",null,null);function g(e){for(let s in d)this[s]=d[s]}const $=function(){return _.exports}();export{$ as default};
