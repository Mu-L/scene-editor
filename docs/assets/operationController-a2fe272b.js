import{n as u,e as p,g as r,A as d,C as l}from"./index-9292a4d7.js";import{a as v}from"./aniScriptLibrary-75c9e81e.js";import"./three-2ccf5448.js";var h=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"operationController-container"},[e("div",{staticClass:"operationGeneral-container"},[e("div",{staticClass:"operationGeneral-search"},[e("el-input",{attrs:{size:"mini",placeholder:"搜索","prefix-icon":"el-icon-search"},model:{value:t.searchValue,callback:function(i){t.searchValue=i},expression:"searchValue"}})],1),e("div",{staticClass:"operationGeneral-time"},[e("span",[t._v(t._s(t.clipCurrentTime+"/"+t.totalTime))])]),e("div",{staticClass:"operationGeneral-control"},[e("vis-icon",{staticStyle:{transform:"rotate(180deg)"},attrs:{code:"#iconkuaijin"},nativeOn:{click:function(i){return(function(){t.$store.commit("animation/lastFrame")}).apply(null,arguments)}}}),e("vis-icon",{attrs:{title:"播放",code:t.play?"#iconzantingtingzhi":"#iconbofang"},nativeOn:{click:function(i){return t.togglePlay.apply(null,arguments)}}}),e("vis-icon",{attrs:{code:"#iconkuaijin"},nativeOn:{click:function(i){return(function(){t.$store.commit("animation/nextFrame")}).apply(null,arguments)}}})],1)]),e("div",{staticClass:"operationMain-container"},[e("div",{staticClass:"operationMain-title-box"},[e("div",{staticClass:"operation-helper"},[e("vis-icon",{attrs:{code:"#iconshanchu",type:"error",title:"删除"}}),e("vis-icon",{attrs:{code:"#iconsanjiaojiantouyou",title:"播放"}}),e("vis-icon",{attrs:{code:"#iconshengyin",title:"声音"}})],1),e("div",{staticClass:"operation-name"},[e("vis-icon",{attrs:{code:"#iconbiaoqian"}}),e("span",[t._v("名称")])],1),e("div",{staticClass:"operation-add"},[e("el-select",{attrs:{size:"mini",filterable:"",placeholder:"选择添加物体"},on:{change:t.addObject},model:{value:t.selectObject,callback:function(i){t.selectObject=i},expression:"selectObject"}},t._l(t.allObject,function(i){return e("el-option",{key:i.vid,attrs:{label:i.name||i.vid,value:i.vid}})}),1)],1)]),e("div",{ref:"item-box",staticClass:"operationMain-item-box",on:{scroll:t.scroll}},t._l(t.animationMap,function(i,o){return e("div",{key:o,staticClass:"operationMain-item",class:{"operationMain-item-chouse":i.chouse},on:{click:function(n){return t.chouseObject(i)}}},[e("div",{staticClass:"item-rootObject"},[e("div",{staticClass:"item-helper"},[e("div",{staticClass:"item-helper-checkBox"},[e("vis-icon",{attrs:{code:"#iconshanchu",title:"删除",type:"error"}})],1),e("div",{staticClass:"item-helper-checkBox"},[e("vis-icon",{directives:[{name:"show",rawName:"v-show",value:i.lock,expression:"item.lock"}],attrs:{code:"#iconsanjiaojiantouyou",title:"播放"}})],1),e("div",{staticClass:"item-helper-checkBox"},[e("vis-icon",{directives:[{name:"show",rawName:"v-show",value:i.voice,expression:"item.voice"}],attrs:{code:"#iconshengyin",title:"声音"}})],1)]),e("div",{staticClass:"item-open-sign",on:{click:function(n){return t.triggleItem(i)}}},[e("vis-icon",{class:{"sign-active":i.open},staticStyle:{transform:"scale(0.7)"},attrs:{code:"#iconsanjiaojiantouyou"}})],1),e("div",{staticClass:"item-name"},[e("span",{domProps:{textContent:t._s(t.getObjectName(o))}})]),e("div",{staticClass:"item-animation-select"},[e("el-dropdown",{on:{command:function(n){return t.addAnimationCommand(n,o,i)}}},[e("span",{staticClass:"el-dropdown-link"},[e("vis-icon",{attrs:{code:"#iconjia1",type:"primary",title:"添加动画"}})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"load"}},[t._v("加载动画")]),e("el-dropdown-item",{attrs:{command:"script"}},[t._v("脚本动画")]),e("el-dropdown-item",{attrs:{command:"keyframe"}},[t._v(" 关键帧动画 ")])],1)],1)],1)]),t.animationTrack[o].load.length?e("div",{directives:[{name:"show",rawName:"v-show",value:i.open,expression:"item.open"}],staticClass:"load-animation-box"},t._l(t.animationTrack[o].load,function(n,c){return e("div",{key:c,staticClass:"item-track"},[e("span",{staticClass:"track-title",domProps:{textContent:t._s(t.actionMap[n].name)}}),e("el-select",{attrs:{placeholder:"选择加载动作",size:"mini"},model:{value:t.actionMap[n].clip,callback:function(s){t.$set(t.actionMap[n],"clip",s)},expression:"actionMap[trackItem].clip"}},t._l(t.clipList,function(s){return e("el-option",{key:s.vid,attrs:{label:s.name,value:s.vid}})}),1)],1)}),0):t._e(),Object.keys(t.animationTrack[o].script).length?e("div",{directives:[{name:"show",rawName:"v-show",value:i.open,expression:"item.open"}],staticClass:"script-animation-box"},t._l(t.animationTrack[o].script,function(n,c){return e("div",{key:c,staticClass:"item-track"},[n.name?e("span",{staticClass:"track-title",domProps:{textContent:t._s(n.name)}}):e("span",{staticClass:"track-pickup",class:{"track-pickup-active":n.pickup},on:{click:function(s){return t.pickup(n)}}},[t._v(" 拾取属性 "),e("vis-icon",{attrs:{code:"#iconxiguan_huaban1",color:"white"}})],1),e("el-select",{attrs:{placeholder:"选择脚本",size:"mini"},on:{change:function(s){return t.change({vid:o,scirpt:n.script.name,item:n})}},model:{value:n.script.name,callback:function(s){t.$set(n.script,"name",s)},expression:"trackItem.script.name"}},t._l(t.aniScriptOptions,function(s){return e("el-option",{key:s.value,attrs:{label:s.label,value:s.value}})}),1)],1)}),0):t._e(),Object.keys(t.animationTrack[o].keyframe).length?e("div",{directives:[{name:"show",rawName:"v-show",value:i.open,expression:"item.open"}],staticClass:"keyframe-animation-box"}):t._e()])}),0)])])},g=[];const f={data(){return{searchValue:"",clipCurrentTime:"00:00:00",aniScriptOptions:[],selectObject:""}},computed:{animationMap(){return this.$store.getters["animation/editorMap"]},animationTrack(){return this.$store.getters["animationTrack/get"]},actionMap(){return this.$store.getters["animationAction/get"]},clipList(){return this.$store.getters["animationClip/list"]},totalTime(){const t=this.$store.getters["animation/totalDuration"];let a="";if(t>=60){const e=Math.floor(t/60);a+=e>=10?e:`0${e}`,a+=":";const i=t-e*60;a+=i>=10?i:`0${i}`,a+=":00"}else a=`00:${t}:00`;return a},play(){return this.$store.getters["animation/play"]},allObject(){const t=[].concat(this.$store.getters.objectMapList);return t.push(this.$store.getters["material/get"],this.$store.getters["texture/get"]),t.reduce((a,e)=>{const i=Object.values(e);return i.length&&a.push(...i),a},[])}},methods:{triggleItem(t){t.open=!t.open},togglePlay(){this.$store.commit("animation/play",!this.play)},scroll(t){this.$emit("scrollHandler",t.target.scrollTop)},getObjectName(t){return p.getConfigBySymbol(t).name},addObject(t){this.$store.commit("animation/add",t),this.$store.commit("animationTrack/add",t),this.selectObject=""},chouseObject(){},change({vid:t,scirpt:a,item:e}){if(e.script.name){const i=r(l.SCRIPTANIMATION,{target:t,attribute:e.attribute,script:d.generateConfig(a)},{strict:!1});p.applyConfig(i),e.script.vid=i.vid}},addAnimationCommand(t,a,e){({load:()=>{if(!e.mixer){const n=r(l.MIXERANIMATION,{target:a});e.mixer=n.vid,this.$store.commit("animation/addMixer",n)}e.open=!0;const o=r(l.ANIMATIONACTION,{mixer:e.mixer});o.name=`动作-${o.vid.slice(-2)}`,this.$store.commit("animationAction/add",o),this.$store.commit("animationTrack/addActionTrack",{object:a,action:o.vid})},script:()=>{this.$store.commit("animationTrack/addEventTrack",{object:a}),e.open=!0}})[t]()},pickup(t){this.$store.commit("animationTrack/pickup",t)}},created(){this.aniScriptOptions=Object.values(v).map(t=>({label:t.desp,value:t.name})),this.aniScriptOptions.unshift({label:"选择脚本",value:""})}},m={};var C=u(f,h,g,!1,b,"742a43cb",null,null);function b(t){for(let a in m)this[a]=m[a]}const $=function(){return C.exports}();export{$ as default};
