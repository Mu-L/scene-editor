import{n as c,e as l,M as a,C as n,J as p}from"./index-9292a4d7.js";import"./three-2ccf5448.js";var d=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"headerOperation-container"},[t("div",{staticClass:"operate-history"},[t("vis-icon",{attrs:{code:"#iconbianjiantouzuo"},nativeOn:{click:function(i){return(function(){e.$store.commit("templateLibrary/backOffHistory")}).apply(null,arguments)}}}),t("vis-icon",{attrs:{code:"#iconbianjiantouyou"},nativeOn:{click:function(i){return(function(){e.$store.commit("templateLibrary/forwardHistory")}).apply(null,arguments)}}})],1),t("div",{staticClass:"operate-address"},e._l(e.addressList,function(i,r){return t("span",{key:r,staticClass:"address-sign-box",on:{click:function(v){return e.chouseFile(i)}}},[r>0?t("vis-icon",{style:{transform:"scale(0.6)"},attrs:{code:"#iconsanjiaojiantouyou"}}):e._e(),t("span",{staticClass:"address-title",domProps:{textContent:e._s(i.name)}})],1)}),0),t("div",{staticClass:"operate-operation"},[t("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"},model:{value:e.classifyVisible,callback:function(i){e.classifyVisible=i},expression:"classifyVisible"}},[t("el-input",{staticClass:"popover-input",attrs:{size:"mini",placeholder:"输入分类名称"},model:{value:e.classifyName,callback:function(i){e.classifyName=i},expression:"classifyName"}}),t("div",{staticClass:"popover-operation"},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.addClassify}},[e._v(" 确定 ")])],1),t("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"新增分类",expression:"'新增分类'",modifiers:{top:!0}},{name:"show",rawName:"v-show",value:e.canAddClassify,expression:"canAddClassify"}],attrs:{slot:"reference",code:"#iconjia1"},slot:"reference"})],1),t("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"},model:{value:e.templateVisible,callback:function(i){e.templateVisible=i},expression:"templateVisible"}},[t("el-input",{staticClass:"popover-input",attrs:{size:"mini",placeholder:"输入模板名称"},model:{value:e.templateName,callback:function(i){e.templateName=i},expression:"templateName"}}),t("div",{staticClass:"popover-operation"},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.addTemplate}},[e._v(" 确定 ")])],1),t("vis-icon",{directives:[{name:"show",rawName:"v-show",value:e.canUpload,expression:"canUpload"},{name:"tooltip",rawName:"v-tooltip.top",value:"保存新模板",expression:"'保存新模板'",modifiers:{top:!0}}],attrs:{slot:"reference",code:"#iconbaocun_mian"},slot:"reference"})],1),e.canUpload?t("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"上传",expression:"'上传'",modifiers:{top:!0}}],attrs:{code:"#iconshangchuan-fill"},nativeOn:{click:function(i){return e.upload.apply(null,arguments)}}}):e._e(),t("input",{ref:"uploadInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".png, .jpg .mp4"},on:{change:e.fileHandler}})],1)])},u=[];const m={data(){return{classifyName:"",classifyVisible:!1,templateName:"",templateVisible:!1}},computed:{currentFloder(){return this.$store.getters["templateLibrary/currentFloder"]},canUpload(){const e=this.currentFloder.children;return console.log(this.currentFloder),e.length&&!e[0].dir?!0:!e.length&&this.currentFloder.name!=="/"},canAddClassify(){const e=this.currentFloder.children;return e.length&&e[0].dir?!0:!e.length},addressList(){const e=[this.currentFloder],s=t=>{t.parent&&(e.unshift(t.parent),s(t.parent))};return s(this.currentFloder),e}},methods:{chouseFile(e){e.dir&&this.$store.commit("templateLibrary/currentFloder",e)},upload(){this.$refs.uploadInput.click()},fileHandler(e){const s=e.target.files[0],t=new FormData;t.append("file",s),t.append("classifyId",this.currentFloder.id),this.axios.upload("/app/upload",t).then(i=>{this.$store.commit("templateLibrary/addChildren",i.data)}).finally(()=>{this.$refs.uploadInput.value=""})},addClassify(){this.classifyName.trim()?this.axios.post("/template/addClassify",{name:this.classifyName.trim(),parentId:this.currentFloder.id}).then(e=>{e.status===200?(this.$store.commit("templateLibrary/addChildren",e.data),this.classifyName="",this.classifyVisible=!1,this.$message.success("添加分类成功！")):this.$message.error(e.message)}):(this.classifyName="",this.classifyVisible=!1)},async addTemplate(){const e=this.$message.loading("正在保存为模板..."),s=l.exportConfig();s[a.CONTROLS]&&delete s[a.CONTROLS],s[a.RENDERER]&&delete s[a.RENDERER],s[a.SCENE]&&delete s[a.SCENE],s[a.PASS]&&delete s[a.PASS],s[a.LIGHT]&&s[a.LIGHT].forEach((t,i,r)=>{[n.AMBIENTLIGHT,n.DIRECTIONALLIGHT,n.HEMISPHERELIGHT].includes(t.type)&&r.splice(i,1)}),this.axios.post("/template/create",{templateName:this.templateName,classifyId:this.currentFloder.id,config:JSON.stringify(s,p.stringify),preview:await l.getScreenshot({width:1920,height:1080})}).then(t=>{t.status===200&&(this.$message.success("保存成功！"),this.templateName="",this.templateVisible=!1)}).finally(()=>{e.close()})}}},o={};var f=c(m,d,u,!1,h,"5bf5749d",null,null);function h(e){for(let s in o)this[s]=o[s]}const _=function(){return f.exports}();export{_ as default};
