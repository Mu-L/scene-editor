import{m as W,o as G,p as V,W as J,q as H,r as Z,s as B,v as K,w as X,x as Q,y as Y,z as ee,A as te,B as se,G as oe,H as ne,I as ae,J as re,N as ie,Q as le,S as ce,T as pe,Y as ue,Z as de,_ as he,$ as fe,a0 as ge,a1 as me,a2 as _e,a3 as ve,V as y,c as A,g as we,n as C,a5 as ye,ae as E,a9 as Ce,ac as Se,a6 as xe,aa as $e,a7 as Re,ah as Le,a8 as be,at as I,E as Ae}from"./texture-e454a176.js";import"./three-679cdae3.js";class Ee extends W{constructor(){super();for(const t of Object.values(G))this.registModule(t);for(const t of Object.values(V))this.resourceManager.addParser(new t);this.install(J({antialias:!0,alpha:!0})).install(H()).install(Z()).install(B({MSAA:!0})).install(K()).install(X()),this.exec(Q()).exec(Y()).exec(ee()).exec(te()).exec(se()).exec(oe()).exec(ne()).exec(ae()).exec(re())}}Object.values(ie).forEach(e=>{le.register(e)});Object.values(ce).forEach(e=>{pe.register(e)});window.VIS={};ue({proxy:{expand:y.observable,timing:"before"}});const h=new Ee().install(de()).install(he()).install(fe()),v=new ge;v.setDRACOLoader(new me);v.setKTX2Loader(new _e);v.setMeshoptDecoder(ve);v.dracoLoader.setDecoderPath("plugins/draco/gltf/");h.loaderManager.register("gltf",v).register("glb",v);h.eventManager.recursive=!0;window.VIS.engine=h;var Pe=function(t,s){if(s=s.split(":")[0],t=+t,!t)return!1;switch(s){case"http":case"ws":return t!==80;case"https":case"wss":return t!==443;case"ftp":return t!==21;case"gopher":return t!==70;case"file":return!1}return t!==0},$={},Me=Object.prototype.hasOwnProperty,Ue;function P(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function M(e){try{return encodeURIComponent(e)}catch{return null}}function Oe(e){for(var t=/([^=?#&]+)=?([^&]*)/g,s={},o;o=t.exec(e);){var r=P(o[1]),a=P(o[2]);r===null||a===null||r in s||(s[r]=a)}return s}function ke(e,t){t=t||"";var s=[],o,r;typeof t!="string"&&(t="?");for(r in e)if(Me.call(e,r)){if(o=e[r],!o&&(o===null||o===Ue||isNaN(o))&&(o=""),r=M(r),o=M(o),r===null||o===null)continue;s.push(r+"="+o)}return s.length?t+s.join("&"):""}$.stringify=ke;$.parse=Oe;var q=Pe,S=$,De=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,T=/[\n\r\t]/g,je=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,z=/:\d+$/,Ie=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,qe=/^[a-zA-Z]:/;function R(e){return(e||"").toString().replace(De,"")}var x=[["#","hash"],["?","query"],function(t,s){return g(s.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],U={hash:1,query:1};function N(e){var t;typeof window<"u"?t=window:typeof A<"u"?t=A:typeof self<"u"?t=self:t={};var s=t.location||{};e=e||s;var o={},r=typeof e,a;if(e.protocol==="blob:")o=new m(unescape(e.pathname),{});else if(r==="string"){o=new m(e,{});for(a in U)delete o[a]}else if(r==="object"){for(a in e)a in U||(o[a]=e[a]);o.slashes===void 0&&(o.slashes=je.test(e.href))}return o}function g(e){return e==="file:"||e==="ftp:"||e==="http:"||e==="https:"||e==="ws:"||e==="wss:"}function F(e,t){e=R(e),e=e.replace(T,""),t=t||{};var s=Ie.exec(e),o=s[1]?s[1].toLowerCase():"",r=!!s[2],a=!!s[3],i=0,l;return r?a?(l=s[2]+s[3]+s[4],i=s[2].length+s[3].length):(l=s[2]+s[4],i=s[2].length):a?(l=s[3]+s[4],i=s[3].length):l=s[4],o==="file:"?i>=2&&(l=l.slice(2)):g(o)?l=s[4]:o?r&&(l=l.slice(2)):i>=2&&g(t.protocol)&&(l=s[4]),{protocol:o,slashes:r||g(o),slashesCount:i,rest:l}}function Te(e,t){if(e==="")return t;for(var s=(t||"/").split("/").slice(0,-1).concat(e.split("/")),o=s.length,r=s[o-1],a=!1,i=0;o--;)s[o]==="."?s.splice(o,1):s[o]===".."?(s.splice(o,1),i++):i&&(o===0&&(a=!0),s.splice(o,1),i--);return a&&s.unshift(""),(r==="."||r==="..")&&s.push(""),s.join("/")}function m(e,t,s){if(e=R(e),e=e.replace(T,""),!(this instanceof m))return new m(e,t,s);var o,r,a,i,l,u,_=x.slice(),w=typeof t,n=this,c=0;for(w!=="object"&&w!=="string"&&(s=t,t=null),s&&typeof s!="function"&&(s=S.parse),t=N(t),r=F(e||"",t),o=!r.protocol&&!r.slashes,n.slashes=r.slashes||o&&t.slashes,n.protocol=r.protocol||t.protocol||"",e=r.rest,(r.protocol==="file:"&&(r.slashesCount!==2||qe.test(e))||!r.slashes&&(r.protocol||r.slashesCount<2||!g(n.protocol)))&&(_[3]=[/(.*)/,"pathname"]);c<_.length;c++){if(i=_[c],typeof i=="function"){e=i(e,n);continue}a=i[0],u=i[1],a!==a?n[u]=e:typeof a=="string"?(l=a==="@"?e.lastIndexOf(a):e.indexOf(a),~l&&(typeof i[2]=="number"?(n[u]=e.slice(0,l),e=e.slice(l+i[2])):(n[u]=e.slice(l),e=e.slice(0,l)))):(l=a.exec(e))&&(n[u]=l[1],e=e.slice(0,l.index)),n[u]=n[u]||o&&i[3]&&t[u]||"",i[4]&&(n[u]=n[u].toLowerCase())}s&&(n.query=s(n.query)),o&&t.slashes&&n.pathname.charAt(0)!=="/"&&(n.pathname!==""||t.pathname!=="")&&(n.pathname=Te(n.pathname,t.pathname)),n.pathname.charAt(0)!=="/"&&g(n.protocol)&&(n.pathname="/"+n.pathname),q(n.port,n.protocol)||(n.host=n.hostname,n.port=""),n.username=n.password="",n.auth&&(l=n.auth.indexOf(":"),~l?(n.username=n.auth.slice(0,l),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=n.auth.slice(l+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(n.auth)),n.auth=n.password?n.username+":"+n.password:n.username),n.origin=n.protocol!=="file:"&&g(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString()}function ze(e,t,s){var o=this;switch(e){case"query":typeof t=="string"&&t.length&&(t=(s||S.parse)(t)),o[e]=t;break;case"port":o[e]=t,q(t,o.protocol)?t&&(o.host=o.hostname+":"+t):(o.host=o.hostname,o[e]="");break;case"hostname":o[e]=t,o.port&&(t+=":"+o.port),o.host=t;break;case"host":o[e]=t,z.test(t)?(t=t.split(":"),o.port=t.pop(),o.hostname=t.join(":")):(o.hostname=t,o.port="");break;case"protocol":o.protocol=t.toLowerCase(),o.slashes=!s;break;case"pathname":case"hash":if(t){var r=e==="pathname"?"/":"#";o[e]=t.charAt(0)!==r?r+t:t}else o[e]=t;break;case"username":case"password":o[e]=encodeURIComponent(t);break;case"auth":var a=t.indexOf(":");~a?(o.username=t.slice(0,a),o.username=encodeURIComponent(decodeURIComponent(o.username)),o.password=t.slice(a+1),o.password=encodeURIComponent(decodeURIComponent(o.password))):o.username=encodeURIComponent(decodeURIComponent(t))}for(var i=0;i<x.length;i++){var l=x[i];l[4]&&(o[l[1]]=o[l[1]].toLowerCase())}return o.auth=o.password?o.username+":"+o.password:o.username,o.origin=o.protocol!=="file:"&&g(o.protocol)&&o.host?o.protocol+"//"+o.host:"null",o.href=o.toString(),o}function Ne(e){(!e||typeof e!="function")&&(e=S.stringify);var t,s=this,o=s.host,r=s.protocol;r&&r.charAt(r.length-1)!==":"&&(r+=":");var a=r+(s.protocol&&s.slashes||g(s.protocol)?"//":"");return s.username?(a+=s.username,s.password&&(a+=":"+s.password),a+="@"):s.password?(a+=":"+s.password,a+="@"):s.protocol!=="file:"&&g(s.protocol)&&!o&&s.pathname!=="/"&&(a+="@"),(o[o.length-1]===":"||z.test(s.hostname)&&!s.port)&&(o+=":"),a+=o+s.pathname,t=typeof s.query=="object"?e(s.query):s.query,t&&(a+=t.charAt(0)!=="?"?"?"+t:t),s.hash&&(a+=s.hash),a}m.prototype={set:ze,toString:Ne};m.extractProtocol=F;m.location=N;m.trimLeft=R;m.qs=S;var Fe=m;const We=we(Fe);var Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"renderWindow-container"},[s("iframe",{ref:"renderMask",staticClass:"render-mask",attrs:{width:"100%",height:"100%",scrolling:"no"}}),s("div",{ref:"renderElement",staticClass:"render-window",attrs:{tabindex:"0"}})])},Ve=[];const Je={data(){return{timer:"",canResize:!0,throttleTime:1e3/60}},async mounted(){h.setDom(this.$refs.renderElement).setSize().play(),this.$watch("play",n=>{n?h.play():h.stop()},{immediate:!0});const e=this.$refs.renderMask;e.contentWindow.addEventListener("resize",n=>{if(this.canResize)this.canResize=!1,this.timer=setTimeout(()=>{h.setSize(e.offsetWidth,e.offsetHeight),this.canResize=!0},this.throttleTime);else return!1});const t=this.$loading({text:"正在初始化项目...",background:"rgba(0, 0, 0, 0.3)"}),o=We(window.location.href,!0).query.id;o||(this.$message.warning("地址不正确！"),t.close(),window.close());let a=(await ye.getApp(o).catch(n=>{this.$message.error(n),t.close()})).app||{};delete a.helper;let i=JSON.stringify(a,E.stringify);!a.assets&&(a.assets=[]),!a.canvasAssets&&(a.canvasAssets=[]);const l=[];a.assets.forEach(n=>{n.module==="model"?l.push(new Promise((c,f)=>{Ce.getModel(n.id).then(p=>{const d=URL.createObjectURL(p.model);i=i.replace(new RegExp(`<${n.module}-${n.id}>`,"g"),d),c({url:d,ext:p.ext})}).catch(f)})):n.module==="texture"&&l.push(new Promise((c,f)=>{Se.getTexture(n.id).then(p=>{const d=URL.createObjectURL(p.texture);i=i.replace(new RegExp(`<${n.module}-${n.id}>`,"g"),d),c({url:d,ext:p.ext})}).catch(f)}))});const u=[];a.canvasAssets.forEach(n=>{u.push(new Promise((c,f)=>{xe.getCanvas(n.id).then(p=>{const d=URL.createObjectURL(p.canvas);i=i.replace(new RegExp(`<${n.module}-${n.id}>`,"g"),d),c({url:d,file:p})}).catch(f)}))});const _=[];a.shaderAssets.forEach(n=>{_.push(new Promise((c,f)=>{$e.getShader(n.id).then(p=>{const d=URL.createObjectURL(p.shader);i=i.replace(new RegExp(`<${n.module}-${n.id}>`,"g"),d),c({url:d,pkg:p.pkg,file:p})}).catch(f)}))}),!a.component&&(a.component=[]);const w=[];a.component.forEach(n=>{const[c,f]=n.$url.slice(1,-1).split("-");w.push(new Promise((p,d)=>{Re.getComponent(f).then(L=>{const b=URL.createObjectURL(L.component);i=i.replace(new RegExp(`<${c}-${f}>`,"g"),b),n.$url=b,n.$pkg=L.pkg,p(n)})}))}),a.assets=await Promise.all(l),a.canvasAssets=await Promise.all(u),a.shaderAssets=await Promise.all(_),a.component=await Promise.all(w),i=JSON.parse(i,E.parse),i.assets=a.assets,i.canvasAssets=a.canvasAssets,i.shaderAssets=a.shaderAssets,i.component=a.component,i.canvas&&i.canvas.forEach(n=>{n.$pkg=a.canvasAssets.find(c=>c.url===n.$url).file.pkg}),a=i,a=Le.handler(a,n=>be(n.type,n,{strict:!1}),{filter:["assets","component","canvasAssets","canvas","shaderAssets"]}),await h.loadConfigAsync(a),h.setSceneBySymbol(a.scene[0].vid),h.play(),t.close()},methods:{}},O={};var He=C(Je,Ge,Ve,!1,Ze,"0a799040",null,null);function Ze(e){for(let t in O)this[t]=O[t]}const Be=function(){return He.exports}();var Ke=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"icon-container",style:{"font-size":e.size,color:e.color}},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":e.code}})])])},Xe=[];const Qe={name:"VisIcon",props:{code:{type:String},size:{type:String},color:{type:String}},data(){return{}},mounted(){},beforeDestroy(){}},k={};var Ye=C(Qe,Ke,Xe,!1,et,null,null,null);function et(e){for(let t in k)this[t]=k[t]}const tt=function(){return Ye.exports}();var st=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.showLoading,expression:"showLoading"}],staticClass:"loadingManager-container"},[s("div",{staticClass:"loadingManage-main"},[e.loadError?s("div",{staticClass:"loadingManager-close",on:{click:e.close}},[s("vis-icon",{attrs:{code:"#iconguanbi"}})],1):e._e(),s("div",{staticClass:"progress-title"},[s("vis-icon",{attrs:{code:"#iconwenjian"}}),e._v(" 正在加载："+e._s(e.title)+" ")],1),s("div",{staticClass:"overall-progress-box"},[s("div",{staticClass:"overall-progress"},[s("div",{staticClass:"overall-progress-main",style:{width:`${e.overllProgress}%`,backgroundColor:e.loadError?"#FF4C4C":null}})]),s("span",{staticClass:"overall-number",domProps:{textContent:e._s(`${e.loadSuccess}/${e.loadTotal}`)}})]),s("div",{staticClass:"detail-progress-box"},[s("div",{staticClass:"detail-title",on:{click:function(){e.showDetail=!e.showDetail}}},[s("span",[e._v("展示详情")]),s("vis-icon",{style:{transform:e.showDetail?"rotate(0)":"rotate(-90deg)"},attrs:{code:"#iconxiala"}})],1),e.showDetail?s("div",{staticClass:"detail-message"},e._l(e.loadDetailMap,function(o,r){return s("div",{key:r,staticClass:"detail-item",style:{color:o.error?"#FF4C4C":null}},[s("span",{staticClass:"detail-url",domProps:{textContent:e._s(o.url)}}),o.error?s("span",{domProps:{textContent:e._s(o.message)}}):[s("span",{staticClass:"detail-seat"}),s("span",{staticClass:"detail-number",domProps:{textContent:e._s(`${o.progress*100}%`)}})]],2)}),0):e._e()])])])},ot=[];const nt={components:{visIcon:tt},data(){return{showLoading:!1,showDetail:!0,title:"",loadTotal:0,loadSuccess:0,loadError:0,loadDetailMap:{}}},computed:{overllProgress(){return this.loadTotal===0?0:this.loadSuccess/this.loadTotal*100}},mounted(){const e=h.loaderManager;e.addEventListener("beforeLoad",t=>{!this.showLoading&&(this.showLoading=!0)}),e.addEventListener("loading",t=>{!this.showLoading&&(this.showLoading=!0),this.loadTotal=t.loadTotal,this.loadSuccess=t.loadSuccess,this.loadError=t.loadError}),e.addEventListener("loaded",t=>{this.loadTotal=t.loadTotal,this.loadSuccess=t.loadSuccess,this.loadError=t.loadError,setTimeout(()=>{this.showLoading=!1},1e3)}),e.addEventListener("detailLoaded",t=>{this.title=t.url,this.loadDetailMap=e.getLoadDetailMap()})},methods:{close(){this.showLoading=!1}}},D={};var at=C(nt,st,ot,!1,rt,"146aa0de",null,null);function rt(e){for(let t in D)this[t]=D[t]}const it=function(){return at.exports}();var lt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("render-window"),s("loading-manager")],1)},ct=[];const pt={components:{renderWindow:Be,loadingManager:it},mounted(){}},j={};var ut=C(pt,lt,ct,!1,dt,"c87061ee",null,null);function dt(e){for(let t in j)this[t]=j[t]}const ht=function(){return ut.exports}();I.start();y.config.productionTip=!1;y.use(Ae);new y({mounted(){I.done()},render:e=>e(ht)}).$mount("#app");
