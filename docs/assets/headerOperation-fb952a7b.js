import{c as d,e as p}from"./index-fa205994.js";import{n as f,a9 as u,M as l,i as c}from"./texture-635886dc.js";import"./three-ea07d844.js";var h=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"headerOperation-container"},[t("div",{staticClass:"operate-history"},[t("vis-icon",{attrs:{code:"#iconbianjiantouzuo"},nativeOn:{click:function(i){return(function(){e.$store.commit("templateLibrary/backOffHistory")}).apply(null,arguments)}}}),t("vis-icon",{attrs:{code:"#iconbianjiantouyou"},nativeOn:{click:function(i){return(function(){e.$store.commit("templateLibrary/forwardHistory")}).apply(null,arguments)}}})],1),t("div",{staticClass:"operate-address"},e._l(e.addressList,function(i,o){return t("span",{key:o,staticClass:"address-sign-box",on:{click:function(a){return e.chouseFile(i)}}},[o>0?t("vis-icon",{style:{transform:"scale(0.6)"},attrs:{code:"#iconsanjiaojiantouyou"}}):e._e(),t("span",{staticClass:"address-title",domProps:{textContent:e._s(i.name)}})],1)}),0),t("div",{staticClass:"operate-operation"},[t("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"},model:{value:e.classifyVisible,callback:function(i){e.classifyVisible=i},expression:"classifyVisible"}},[t("el-input",{staticClass:"popover-input",attrs:{size:"mini",placeholder:"输入分类名称"},model:{value:e.classifyName,callback:function(i){e.classifyName=i},expression:"classifyName"}}),t("div",{staticClass:"popover-operation"},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.addClassify}},[e._v(" 确定 ")])],1),t("vis-icon",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:"新增分类",expression:"'新增分类'",modifiers:{top:!0}},{name:"show",rawName:"v-show",value:e.canAddClassify,expression:"canAddClassify"}],attrs:{slot:"reference",code:"#iconjia1"},slot:"reference"})],1),t("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"},model:{value:e.templateVisible,callback:function(i){e.templateVisible=i},expression:"templateVisible"}},[t("el-input",{staticClass:"popover-input",attrs:{size:"mini",placeholder:"输入模板名称"},model:{value:e.templateName,callback:function(i){e.templateName=i},expression:"templateName"}}),t("div",{staticClass:"popover-operation"},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.addTemplate}},[e._v(" 确定 ")])],1),t("vis-icon",{directives:[{name:"show",rawName:"v-show",value:e.canUpload,expression:"canUpload"},{name:"tooltip",rawName:"v-tooltip.top",value:"当前场景保存为新模板",expression:"'当前场景保存为新模板'",modifiers:{top:!0}}],attrs:{slot:"reference",code:"#iconbaocun_mian"},slot:"reference"})],1)],1)])},v=[];const y={data(){return{classifyName:"",classifyVisible:!1,templateName:"",templateVisible:!1}},computed:{currentFloder(){return this.$store.getters["templateLibrary/currentFloder"]},canUpload(){const e=this.currentFloder.children;return console.log(this.currentFloder),e.length&&!e[0].dir?!0:!e.length&&this.currentFloder.name!=="/"},canAddClassify(){const e=this.currentFloder.children;return e.length&&e[0].dir?!0:!e.length},addressList(){const e=[this.currentFloder],s=t=>{t.parent&&(e.unshift(t.parent),s(t.parent))};return s(this.currentFloder),e}},methods:{chouseFile(e){e.dir&&this.$store.commit("templateLibrary/currentFloder",e)},upload(){this.$refs.uploadInput.click()},fileHandler(e){const s=e.target.files[0],t=new FormData;t.append("file",s),t.append("classifyId",this.currentFloder.id),this.axios.upload("/config/upload",t).then(i=>{this.$store.commit("templateLibrary/addChildren",i.data)}).finally(()=>{this.$refs.uploadInput.value=""})},addClassify(){this.classifyName.trim()?d.addClassify({name:this.classifyName.trim(),parentId:this.currentFloder.id}).then(e=>{this.$store.commit("templateLibrary/addChildren",e),this.classifyName="",this.classifyVisible=!1,this.$message.success("添加分类成功！")}).catch(e=>{this.$message.error("数据库有误：templateApi.addClassify"),console.error(e)}):(this.classifyName="",this.classifyVisible=!1)},async addTemplate(){const e=this.$message.loading("正在保存为模板...");let s=p.exportConfig(),t=JSON.stringify(s,u.stringify);const i=await this.$store.dispatch("exportConfig");s[l.CONTROLS]&&delete s[l.CONTROLS],s[l.RENDERER]&&delete s[l.RENDERER],s[l.SCENE]&&delete s[l.SCENE],s[l.PASS]&&delete s[l.PASS],s[l.LIGHT]&&s[l.LIGHT].forEach((a,r,n)=>{[c.AMBIENTLIGHT,c.DIRECTIONALLIGHT,c.HEMISPHERELIGHT].includes(a.type)&&n.splice(r,1)});const o=this.$store.getters.urlDetails;s.assets=s.assets.map(a=>{const r={id:null,module:null};if(!o[a.url])this.$message.console.error(`导出失败，未找到相关资源缓存：${a.url}`);else{const n=o[a.url];r.id=n.id,r.module=n.model?"model":n.texture?"texture":null,t=t.replace(new RegExp(a.url,"g"),`<${r.module}-${r.id}>`)}return r}),s.component.forEach(a=>{const r={id:null,module:"component"};if(!o[a.$url])this.$message.error(`导出失败，未找到相关资源缓存：${a.$url}`);else{const n=o[a.$url];r.id=n.id,t=t.replace(new RegExp(a.$url,"g"),`<${r.module}-${r.id}>`)}a.$url=`<${r.module}-${r.id}>`}),t=JSON.parse(t,u.parse),t.assets=s.assets,s=t,d.creatTemplate({name:this.templateName,classifyId:this.currentFloder.id,template:s,editor:i,preview:await p.getScreenshot({width:960,height:540})}).then(a=>{this.$message.success("保存成功！"),this.templateName="",this.templateVisible=!1,this.$store.commit("templateLibrary/addChildren",a)}).finally(()=>{e.close()})}}},m={};var g=f(y,h,v,!1,$,"ef45a5ee",null,null);function $(e){for(let s in m)this[s]=m[s]}const N=function(){return g.exports}();export{N as default};
