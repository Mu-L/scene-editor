import{e as o}from"./index-701b8272.js";import{n as h,a6 as g,af as r}from"./texture-7d506f8b.js";import"./three-c85558b8.js";var d=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"operateNavigation-container"},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(i){e.screenshotDialogVisible=!0}}},[e._v(" 快照 ")]),t("el-button",{attrs:{size:"mini",type:"success"},on:{click:e.save}},[e._v("保存")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.display}},[e._v("展示")]),t("el-dialog",{attrs:{title:"快照设置",visible:e.screenshotDialogVisible,width:"30%",center:""},on:{"update:visible":function(i){e.screenshotDialogVisible=i}}},[t("el-form",{attrs:{"label-position":"left","label-width":"90px"}},[t("el-form-item",{attrs:{label:"文件名"}},[t("el-input",{attrs:{size:"mini"},model:{value:e.screenshotSetting.name,callback:function(i){e.$set(e.screenshotSetting,"name",i)},expression:"screenshotSetting.name"}})],1),t("el-form-item",{attrs:{label:"宽度（px）"}},[t("el-input-number",{attrs:{size:"mini",controls:!1},model:{value:e.screenshotSetting.width,callback:function(i){e.$set(e.screenshotSetting,"width",i)},expression:"screenshotSetting.width"}})],1),t("el-form-item",{attrs:{label:"高度（px）"}},[t("el-input-number",{attrs:{size:"mini",controls:!1},model:{value:e.screenshotSetting.height,callback:function(i){e.$set(e.screenshotSetting,"height",i)},expression:"screenshotSetting.height"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:function(i){e.screenshotDialogVisible=!1}}},[e._v(" 取 消 ")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getScreenshot}},[e._v(" 确 定 ")])],1)],1)],1)},p=[];const m={data(){return{screenshotDialogVisible:!1,buildDialogVisible:!1,screenshotSetting:{width:1920,height:1080,name:"vis-screenshot"},exportSetting:{name:"vis-scene"}}},computed:{name(){return this.$store.getters.name},id(){return this.$store.getters.id}},mounted(){o.keyboardManager.register({shortcutKey:["ctrl","s"],desp:"在线保存",keydown:e=>{e.preventDefault(),e.stopPropagation(),this.save()}})},methods:{async getScreenshot(){const e=await o.getScreenshot({width:this.screenshotSetting.width,height:this.screenshotSetting.height}),s=document.createElement("a");s.download=this.screenshotSetting.name,s.href=e,s.click(),this.screenshotDialogVisible=!1,this.screenshotSetting={width:1920,height:1080,name:"vis-screenshot"}},async save(){const e=this.$loading({text:"正在保存...",background:"rgb(0, 0, 0)",target:".renderWindow-container"}),s=await this.$store.dispatch("exportConfig"),t=await o.getScreenshot({width:1920,height:1080});let i=await this.$store.dispatch("urlTransform",o.exportConfig());g.saveApp({id:this.id,name:this.name,app:i,editor:s,preview:t}).then(n=>{console.log(n),this.$message.success("保存成功！")}).finally(()=>{e.close()})},display(){window.open(window.location.origin+window.location.pathname+`/preview.html?id=${this.id}`)},async download(){const e=this.$loading({text:"正在打包项目...",background:"rgb(0, 0, 0)",target:".renderWindow-container"}),s=await this.$store.dispatch("exportConfig"),t=await o.getScreenshot({width:1920,height:1080}),{app:i,zip:n}=await this.$store.dispatch("exportTransform",o.exportConfig());n.file("editor.json",JSON.stringify(s,r.stringify)),n.file("app.json",JSON.stringify(i,r.stringify)),n.file("preview.png",this.$tool.dataURLToBlob(t));const c=await n.generateAsync({type:"blob"}),a=document.createElement("a");a.download=`${this.$store.getters.name}.zip`,a.href=URL.createObjectURL(c),a.click(),e.close()}}},l={};var u=h(m,d,p,!1,f,"83eacc48",null,null);function f(e){for(let s in l)this[s]=l[s]}const _=function(){return u.exports}();export{_ as default};
